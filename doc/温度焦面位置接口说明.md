# FpgaSimulator 温度与焦面位置设置接口说明

## 概述

在 `FpgaSimulator` 类中添加了温度和焦面位置设置接口,用于模拟主镜、次镜温度以及可见光、红外焦面位置。

## 接口说明

### 1. 主镜温度设置

```cpp
void setPrimaryMirrorTemp(int16_t temp);
int16_t getPrimaryMirrorTemp() const;
```

**参数:**
- `temp`: 主镜温度,单位 0.1℃ (例如: 250 表示 25.0℃)
- LSB = 0.1℃
- 对应字段: `mess_From_QNSJ.zjwdxx`

### 2. 次镜温度设置

```cpp
void setSecondaryMirrorTemp(int16_t temp);
int16_t getSecondaryMirrorTemp() const;
```

**参数:**
- `temp`: 次镜温度,单位 0.1℃ (例如: 250 表示 25.0℃)
- LSB = 0.1℃
- 对应字段: `mess_From_QNSJ.cjwdxx`

### 3. 温度ID设置

```cpp
void setTempID(uint8_t id);
uint8_t getTempID() const;
```

**参数:**
- `id`: 温度信息ID, 范围 1-10 (循环发送)
- 超出范围会自动限制并输出警告
- 对应字段: `mess_From_QNSJ.tem_ID`

### 4. 可见光焦面位置设置

```cpp
void setVisibleFocalPlanePosition(int16_t pos_mm);
int16_t getVisibleFocalPlanePosition() const;
```

**参数:**
- `pos_mm`: 可见光焦面位置,单位 0.001mm (例如: 1000 表示 1.0mm)
- LSB = 0.001mm
- 对应字段: `mess_From_TJ.jmwz_kj_real`

### 5. 红外焦面位置设置

```cpp
void setInfraredFocalPlanePosition(int16_t pos_mm);
int16_t getInfraredFocalPlanePosition() const;
```

**参数:**
- `pos_mm`: 红外焦面位置,单位 0.001mm (例如: 1000 表示 1.0mm)
- LSB = 0.001mm
- 对应字段: `mess_From_TJ.jmwz_hw_real`

## 默认值设置

### 初始化时的默认温度值

在 `FpgaSimulator::init()` 中自动设置:
- **主镜温度**: 200 (20.0℃) - 室温环境
- **次镜温度**: 200 (20.0℃) - 室温环境
- **温度ID**: 1

### 拍照时的默认焦面位置

在首次执行 `FPGA_START_PHOTO` 时自动设置:
- **可见光焦面位置**: 0 (0.0mm) - 焦平面中心位置
- **红外焦面位置**: 0 (0.0mm) - 焦平面中心位置

## 使用示例

### 示例1: 设置环境温度

```cpp
// 模拟高温环境: 35℃
fpga_sim_->setPrimaryMirrorTemp(350);
fpga_sim_->setSecondaryMirrorTemp(350);

// 模拟低温环境: -10℃
fpga_sim_->setPrimaryMirrorTemp(-100);
fpga_sim_->setSecondaryMirrorTemp(-100);
```

### 示例2: 设置焦面位置

```cpp
// 设置可见光焦面位置为 2.5mm
fpga_sim_->setVisibleFocalPlanePosition(2500);

// 设置红外焦面位置为 -1.5mm
fpga_sim_->setInfraredFocalPlanePosition(-1500);
```

### 示例3: 温度循环发送模拟

```cpp
// 在step()或定时器中模拟温度ID循环
static uint8_t temp_id = 1;
fpga_sim_->setTempID(temp_id);
temp_id = (temp_id % 10) + 1; // 1-10循环
```

### 示例4: 读取当前值

```cpp
int16_t primary_temp = fpga_sim_->getPrimaryMirrorTemp();
int16_t secondary_temp = fpga_sim_->getSecondaryMirrorTemp();
log_info("主镜温度: %.1f℃, 次镜温度: %.1f℃", 
         primary_temp * 0.1f, secondary_temp * 0.1f);

int16_t visible_focal = fpga_sim_->getVisibleFocalPlanePosition();
int16_t infrared_focal = fpga_sim_->getInfraredFocalPlanePosition();
log_info("可见光焦面位置: %.3f mm, 红外焦面位置: %.3f mm",
         visible_focal * 0.001f, infrared_focal * 0.001f);
```

### 示例5: 根据外部输入动态设置

```cpp
void CameraSimulator::step() {
    // 从共享内存或其他数据源获取温度
    if (input_data.has_temperature_update) {
        fpga_sim_->setPrimaryMirrorTemp(input_data.primary_mirror_temp);
        fpga_sim_->setSecondaryMirrorTemp(input_data.secondary_mirror_temp);
    }
    
    // 拍照时动态调整焦面位置
    if (is_photographing) {
        fpga_sim_->setVisibleFocalPlanePosition(calculated_visible_focus);
        fpga_sim_->setInfraredFocalPlanePosition(calculated_infrared_focus);
    }
}
```

## 数据流向

```
温度数据流:
fpga_sim (设置) -> mess_From_QNSJ -> mess_To_TJ -> 调焦模块

焦面位置数据流:
fpga_sim (设置) -> mess_From_TJ -> nbMess_jt_Photo -> 注释信息
```

## 相关文件

- 接口声明: `yc_camera_sim/include/fpga_sim.h`
- 接口实现: `yc_camera_sim/src/fpga_sim.cpp`
- 数据结构定义: `yc_camera_sim/include/yc/YC_Controller_FPGA_Mess.h`
- 消息处理: `yc_camera_sim/lib/yc_con/src/YC_Controller_Mess_Process.cpp`

## 注意事项

1. **温度单位**: LSB = 0.1℃, 设置值需乘以10 (例如: 20℃ -> 200)
2. **焦面位置单位**: LSB = 0.001mm, 设置值需乘以1000 (例如: 1mm -> 1000)
3. **温度ID范围**: 1-10, 超出范围会自动限制
4. **默认值时机**:
   - 温度在 `init()` 时设置 (20℃)
   - 焦面位置在首次 `FPGA_START_PHOTO` 时设置 (0mm)
5. **负值支持**: 温度和焦面位置都支持负值 (int16_t类型)
