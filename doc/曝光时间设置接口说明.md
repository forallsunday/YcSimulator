# FpgaSimulator 曝光时间设置接口说明

## 概述

已在 `FpgaSimulator` 类中添加曝光时间设置接口,用于在仿真环境中动态调整可见光和红外的曝光时间。

## 接口说明

### 1. 设置可见光曝光时间

```cpp
void setVisibleExposureTime(int32_t exp_time_ms);
```

**参数:**
- `exp_time_ms`: 可见光曝光时间,单位毫秒(ms)
- 有效范围: 5 ~ 150 ms
- 超出范围会自动限制并输出警告日志

**对应变量:**
- `tg_Param.KJ_ExpTime`: 主曝光时间值
- `tg_Param.KJ_ExpTime_float`: 浮点型曝光时间
- `tg_Param.KJ_ExpTimeH8`: 高8位
- `tg_Param.KJ_ExpTimeL8`: 低8位

### 2. 设置红外曝光时间

```cpp
void setInfraredExposureTime(uint16_t exp_time_us);
```

**参数:**
- `exp_time_us`: 红外曝光时间,单位微秒(μs)
- 有效范围: 2000 ~ 16000 μs
- 超出范围会自动限制并输出警告日志

**对应变量:**
- `tg_Param.HW_ExpTime`: 主曝光时间值
- `tg_Param.HW_ExpTime_float`: 浮点型曝光时间
- `tg_Param.HW_ExpTimeH8`: 高8位
- `tg_Param.HW_ExpTimeL8`: 低8位

### 3. 获取曝光时间

```cpp
int32_t getVisibleExposureTime() const;      // 获取可见光曝光时间(ms)
uint16_t getInfraredExposureTime() const;    // 获取红外曝光时间(μs)
```

## 使用示例

### 在 CameraSimulator 中使用

```cpp
// 在 camera_sim.cpp 的某个初始化或更新函数中:

// 设置可见光曝光时间为 50ms
fpga_sim_->setVisibleExposureTime(50);

// 设置红外曝光时间为 8000μs
fpga_sim_->setInfraredExposureTime(8000);

// 读取当前曝光时间
int32_t kj_exp = fpga_sim_->getVisibleExposureTime();
uint16_t hw_exp = fpga_sim_->getInfraredExposureTime();
log_info("当前曝光时间 - 可见: %d ms, 红外: %d μs", kj_exp, hw_exp);
```

### 根据共享内存参数动态设置

```cpp
// 在 step() 函数中根据外部输入动态调整
void CameraSimulator::step() {
    // ... 其他代码 ...
    
    // 假设从共享内存读取到曝光时间参数
    if (input_data.visible_exposure_time > 0) {
        fpga_sim_->setVisibleExposureTime(input_data.visible_exposure_time);
    }
    
    if (input_data.infrared_exposure_time > 0) {
        fpga_sim_->setInfraredExposureTime(input_data.infrared_exposure_time);
    }
}
```

## 当前默认值

根据 `YC_Controller_TG_Process.cpp` 中的初始化:
- 可见光曝光时间: **20 ms**
- 红外曝光时间: **6000 μs**

## 相关文件

- 接口声明: `yc_camera_sim/include/fpga_sim.h`
- 接口实现: `yc_camera_sim/src/fpga_sim.cpp`
- 调光参数: `yc_camera_sim/lib/yc_con/include/YC_Controller_TG_Process.h`
- 调光流程: `yc_camera_sim/lib/yc_con/src/YC_Controller_TG_Process.cpp`

## 注意事项

1. 设置的曝光时间会立即生效,影响后续的调光流程
2. 超出范围的值会被自动限制到最小/最大值
3. 设置时会自动更新相关的高低8位字段,保持数据一致性
4. 每次设置会输出日志,便于调试跟踪
